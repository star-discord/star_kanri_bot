# STAR 管理Bot

**STAR 管理Bot** は、Discord上でギルドやクランの運営を効率化するための多機能Botです。
「凸スナ報告」や「KPI管理」といった運営に不可欠な機能を、直感的なUIで提供します。
堅牢なデータ管理とモジュール化されたアーキテクチャにより、安定した運用と容易な機能拡張を実現します。

---

## ✨ 主な機能

- **凸スナ管理**:
  - `/凸スナ設置` で、対話的に報告メッセージを設置。
  - 報告ボタンを押すと、セレクトメニューとモーダルによるスムーズな報告UIを提供。
  - 報告内容はCSVファイルに自動で記録されます。
- **KPI管理**:
  - `/star_KPI設定` で、店舗やチームごとの目標を設定。
  - `/star_KPI設置` で報告用UIを設置し、日々の実績を簡単に報告。
  - 実績データもCSVファイルに記録されます。
- **権限管理**:
  - `/STAR管理bot設定` で、Botの管理者ロールを柔軟に設定可能。
  - コマンドはロールに基づいて保護されます。
- **堅牢なアーキテクチャ**:
  - `configManager` による安全なデータ永続化（ファイルロック対応）。
  - `unifiedInteractionHandler` による統一されたインタラクション処理。
  - `Jest` による自動テストで、コードの品質を保証。
- **運用スクリプト**:
  - `init_server.sh`: 新規サーバーへの初回セットアップを自動化。
  - `update.sh`: GitHubからの安全な更新と再起動。
  - `backup_handler.sh`: `.env` や `data` ディレクトリを保護。

---

## 🚀 セットアップ手順

### 1. 前提条件
- Node.js v18以上
- git, curl, rsync
- Discord Bot のトークン・Client ID

### 2. 新規サーバーへの初期セットアップ

1.  **リポジトリのクローン**:
    ```bash
    git clone https://github.com/star-discord/star_kanri_bot.git
    cd star_kanri_bot
    ```
2.  **初期化スクリプトの実行**:
    ```bash
    chmod +x init_server.sh
    ./init_server.sh
    ```
    スクリプトがシステム設定、Node.js、PM2のインストール、プロジェクトのセットアップを自動で行います。
3.  **.envファイルの編集**:
    スクリプトの指示に従い、`.env` ファイルにBotのトークンなどを設定します。
    ```bash
    nano .env
    ```
4.  **PM2の自動起動設定**:
    スクリプトの最後に表示される `sudo env ...` から始まるコマンドをコピー＆ペーストして実行し、サーバー再起動時にBotが自動で起動するように設定します。

---

## 🔧 運用と開発

| コマンド                | 説明                                           |
| ----------------------- | ---------------------------------------------- |
| `./update.sh`           | BotをGitHubの最新版に安全に更新し、再起動します。 |
| `pm2 status`            | Botの動作状況（オンライン/オフライン）を確認します。 |
| `pm2 logs star-kanri-bot` | Botのログをリアルタイムで表示します。              |
| `npm test`              | 自動テストを実行し、コードの品質を検証します。     |
| `npm run dev`           | 開発モードでBotを起動します（ファイル変更で自動再起動）。 |
| `npm run format`        | Prettierを使ってコードを整形します。             |
| `npm run lint`          | ESLintを使ってコードの問題点をチェックします。     |
