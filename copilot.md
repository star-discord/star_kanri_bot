# STARç®¡ç†Bot é–‹ç™ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

STARç®¡ç†Botã¯ã€Discordç”¨ã®å¤šæ©Ÿèƒ½ç®¡ç†ãƒœãƒƒãƒˆã§ã™ã€‚KPIç®¡ç†ã€å‡¸ã‚¹ãƒŠï¼ˆçªç™ºã‚¹ãƒŠãƒƒã‚¯å ±å‘Šï¼‰ã‚·ã‚¹ãƒ†ãƒ ã€ChatGPTé€£æºæ©Ÿèƒ½ã‚’çµ±åˆã—ã¦ã„ã¾ã™ã€‚

## å®Ÿè£…ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

### ç®¡ç†ç³»ã‚³ãƒãƒ³ãƒ‰
- `/starç®¡ç†botè¨­å®š` - ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã¨é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã®è¨­å®š
- `/starç®¡ç†bot_ä»•æ§˜æ›¸` - ãƒœãƒƒãƒˆã®ä»•æ§˜æ›¸è¡¨ç¤º

### KPIç®¡ç†ç³»
- `/kpi_è¨­å®š` - KPIå ±å‘Šã®æ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
- `/kpi_setting` - KPIè¨­å®šç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º

### å‡¸ã‚¹ãƒŠç®¡ç†ç³»
- `/å‡¸ã‚¹ãƒŠè¨­ç½®` - å‡¸ã‚¹ãƒŠå ±å‘ŠUIã‚’ãƒãƒ£ãƒ³ãƒãƒ«ã«è¨­ç½®
- `/å‡¸ã‚¹ãƒŠè¨­å®š` - è¨­ç½®æ¸ˆã¿å‡¸ã‚¹ãƒŠã®ç¢ºèªãƒ»ç·¨é›†
- `/å‡¸ã‚¹ãƒŠcsv` - ä»Šæœˆã®å‡¸ã‚¹ãƒŠå ±å‘ŠCSVä¿å­˜çŠ¶æ³ç¢ºèª

### ChatGPTé€£æºç³»
- `/star_chat_gpt_config` - ChatGPTè¨­å®šç®¡ç†
- `/star_chat_gpt_setti` - ChatGPTæ¡ˆå†…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒœã‚¿ãƒ³è¨­ç½®

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

### ä¸»è¦ä¾å­˜é–¢ä¿‚ï¼ˆpackage.jsonï¼‰
```json
{
  "dependencies": {
    "discord.js": "^14.x.x",
    "dotenv": "^16.x.x",
    "uuid": "^9.x.x",
    "exceljs": "^4.x.x",
    "@google-cloud/storage": "^6.x.x",
    "openai": "^3.x.x"
  },
  "devDependencies": {
    "node": "^20.19.3"
  }
}
```

### å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
- **Google Cloud Storage**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»åŒæœŸ
- **OpenAI API**: ChatGPTæ©Ÿèƒ½
- **Discord API**: BotåŸºæœ¬æ©Ÿèƒ½

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
project/
â”œâ”€â”€ commands/              # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ events/                # Discord ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
â”œâ”€â”€ utils/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒãƒ³ãƒ‰ãƒ©
â”‚   â”œâ”€â”€ permissions/       # æ¨©é™ç®¡ç†
â”‚   â”œâ”€â”€ kpi_setti/        # KPIæ©Ÿèƒ½
â”‚   â”œâ”€â”€ star_chat_gpt_setti/ # ChatGPTæ©Ÿèƒ½
â”‚   â”œâ”€â”€ star_config/      # è¨­å®šç®¡ç†
â”‚   â”œâ”€â”€ totusuna_setti/   # å‡¸ã‚¹ãƒŠæ©Ÿèƒ½
â”‚   â””â”€â”€ totusuna_config/  # å‡¸ã‚¹ãƒŠè¨­å®š
â””â”€â”€ data/                 # ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

### ã‚³ã‚¢è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
```javascript
// utils/handlerLoader.js
function loadHandlers(dirPath) {
  // å‹•çš„ã«ãƒãƒ³ãƒ‰ãƒ©ã‚’èª­ã¿è¾¼ã¿ã€customId/customIdStartã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
}
```

#### 2. æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
```javascript
// utils/permissions/requireAdmin.js
function requireAdmin(executeFunction) {
  // ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯å¾Œã«å®Ÿè¡Œé–¢æ•°ã‚’ãƒ©ãƒƒãƒ—
}
```

#### 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çµ±åˆå‡¦ç†
```javascript
// utils/buttonsHandler.js, modalsHandler.js, selectsHandler.js
// å„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã‚’çµ±ä¸€çš„ã«å‡¦ç†
```

## æ–‡å­—åŒ–ã‘å•é¡Œã¨å¯¾å‡¦æ³•

### ç™ºç”Ÿã—ãŸå•é¡Œ
PowerShellã‚’ä½¿ç”¨ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã«ã‚ˆã‚Šã€æ—¥æœ¬èªæ–‡å­—ãŒæ–‡å­—åŒ–ã‘ã™ã‚‹å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

### æ–‡å­—åŒ–ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç‰¹å®š
ä»¥ä¸‹ã®ã‚ˆã†ãªç‰¹å¾´çš„ãªæ–‡å­—åŒ–ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç™ºè¦‹ãƒ»ä¿®æ­£ã—ã¾ã—ãŸï¼š

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: PowerShellç”±æ¥ã®æ–‡å­—åŒ–ã‘
```
ä¿®æ­£å‰: ã‚E, ã™E, ï¼E, é–E, å†E, è¤E, â†E
ä¿®æ­£å¾Œ: ã‚, ã™, ï¼, é–, å†, è¤, â† (æ­£å¸¸ãªæ—¥æœ¬èªæ–‡å­—)
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: çµµæ–‡å­—ã®æ–‡å­—åŒ–ã‘
```
ä¿®æ­£å‰: ï¿½, è€E, çE
ä¿®æ­£å¾Œ: ğŸ¤–, âš™ï¸, ğŸ“£ (æ­£å¸¸ãªçµµæ–‡å­—)
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã®ç ´æ
```
ä¿®æ­£å‰: const { SlashCommand[ç ´æ]const content = `ğŸ¤– **ChatGPTæ¡ˆå†…**\n[...]
ä¿®æ­£å¾Œ: const { SlashCommandBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle, MessageFlags } = require('discord.js');
```

### å¯¾å‡¦æ³•

#### 1. æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ä¸€æ‹¬æ¤œå‡º
```bash
grep -r "ã‚E|ã™E|ï¼E|é–E|å†E|è¤E|â†E|ï¿½E" --include="*.js" ./
```

#### 2. æ®µéšçš„ä¿®æ­£ãƒ—ãƒ­ã‚»ã‚¹
1. **æ–‡å­—åŒ–ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç‰¹å®š**: æ­£è¦è¡¨ç¾ã§æ–‡å­—åŒ–ã‘ç®‡æ‰€ã‚’æ¤œç´¢
2. **æ–‡è„ˆã®ç¢ºèª**: å‰å¾Œã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰æ­£ã—ã„æ–‡å­—ã‚’æ¨å®š
3. **ç½®æ›ä¿®æ­£**: æ­£ç¢ºãªæ–‡å­—åˆ—ç½®æ›ã§ä¿®æ­£
4. **æ§‹æ–‡ãƒã‚§ãƒƒã‚¯**: Node.jsæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã§æ¤œè¨¼

#### 3. PowerShellä½¿ç”¨ç¦æ­¢
```javascript
// æ–‡å­—åŒ–ã‘é˜²æ­¢ã®ãŸã‚ã€PowerShellé–¢é€£ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚’ç¦æ­¢
// ä»£æ›¿æ¡ˆ: Node.jsæ¨™æº–APIã¾ãŸã¯Unixç³»ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨
```

### ä¿®æ­£ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
- `commands/star_chat_gpt_setti.js`: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã¨çµµæ–‡å­—ã®ä¿®æ­£
- `utils/kpiFileUtil.js`: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã®æ—¥æœ¬èªä¿®æ­£
- `utils/star_chat_gpt_setti/buttons/chatgpt_config_button.js`: ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¿ã‚¤ãƒˆãƒ«çµµæ–‡å­—ä¿®æ­£
- `utils/star_chat_gpt_setti/buttons/star_chat_gpt_setti_button.js`: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚³ãƒ¡ãƒ³ãƒˆã¨çµµæ–‡å­—ä¿®æ­£

## ãƒ‡ãƒ¼ã‚¿ç®¡ç†

### JSONè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
```javascript
// data/<guildId>/<guildId>.json
{
  "star_config": {
    "adminRoleIds": ["role_id_1", "role_id_2"],
    "notifyChannelId": "channel_id"
  },
  "totsuna": {
    "instances": [
      {
        "id": "uuid",
        "userId": "user_id",
        "body": "å ±å‘Šå†…å®¹",
        "installChannelId": "channel_id",
        "replicateChannelIds": ["channel_id_1"],
        "messageId": "message_id"
      }
    ]
  }
}
```

### CSV/Excelå‡ºåŠ›
- **å‡¸ã‚¹ãƒŠå ±å‘Š**: `data/<guildId>/<å¹´æœˆ>-å‡¸ã‚¹ãƒŠå ±å‘Š.csv`
- **KPIãƒ‡ãƒ¼ã‚¿**: ExcelJS + Google Cloud Storageé€£æº

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ç’°å¢ƒå¤‰æ•°ç®¡ç†
```bash
# .env
DISCORD_TOKEN=your_discord_bot_token
OPENAI_API_KEY=your_openai_api_key
GCS_BUCKET_NAME=your_gcs_bucket
GCP_PROJECT_ID=your_gcp_project
GCP_CREDENTIALS_JSON=path/to/service-account.json
```

### æ¨©é™åˆ¶å¾¡
- ç®¡ç†è€…ã‚³ãƒãƒ³ãƒ‰ã¯`requireAdmin`ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ä¿è­·
- ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- Ephemeralãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### PM2è¨­å®šï¼ˆecosystem.config.jsï¼‰
```javascript
module.exports = {
  apps: [{
    name: 'star_kanri_bot',
    script: './index.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G'
  }]
};
```

### Gitç®¡ç†
```bash
# ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒª
git remote add origin https://github.com/star-discord/star_kanri_bot.git

# ãƒ‡ãƒ—ãƒ­ã‚¤
git add .
git commit -m "æ–‡å­—åŒ–ã‘ä¿®æ­£: æœ€çµ‚æ®µéšå®Œäº†"
git push origin master
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. æ–‡å­—åŒ–ã‘ç™ºç”Ÿæ™‚
1. `grep -r "ã‚E|ã™E|ï¼E" --include="*.js" ./` ã§æ¤œç´¢
2. ã‚¨ãƒ‡ã‚£ã‚¿ã§UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¢ºèª
3. PowerShellã§ã¯ãªãNode.jsã‚„Unixã‚³ãƒãƒ³ãƒ‰ä½¿ç”¨

### 2. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼
1. `node -c deploy-commands.js` ã§æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šç¢ºèª
3. Discord Bot Tokenã®æœ‰åŠ¹æ€§ç¢ºèª

### 3. æ¨©é™ã‚¨ãƒ©ãƒ¼
1. `star_config.adminRoleIds`ã®è¨­å®šç¢ºèª
2. ãƒœãƒƒãƒˆã®æ¨©é™è¨­å®šç¢ºèª
3. ãƒãƒ£ãƒ³ãƒãƒ«æ¨©é™ã®ç¢ºèª

## é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰

### æ–°æ©Ÿèƒ½è¿½åŠ æ‰‹é †
1. `commands/`ã«ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 
2. `utils/`ã«å¯¾å¿œã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©ä½œæˆ
3. `handlerLoader.js`ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
4. æ¨©é™ãŒå¿…è¦ãªå ´åˆã¯`requireAdmin`é©ç”¨

### ã‚³ãƒ¼ãƒ‰å“è³ª
- ESLintè¨­å®šã«ã‚ˆã‚‹ä¸€è²«ã—ãŸã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«
- JSDocã«ã‚ˆã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€ï¼ˆ`errorHelper.js`ï¼‰

### ãƒ†ã‚¹ãƒˆç’°å¢ƒ
- é–‹ç™ºç”¨Discordã‚µãƒ¼ãƒãƒ¼ã§ã®ãƒ†ã‚¹ãƒˆæ¨å¥¨
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã«ã‚ˆã‚‹ãƒ‡ãƒãƒƒã‚°æƒ…å ±å‡ºåŠ›
- PM2ã«ã‚ˆã‚‹æœ¬ç•ªç’°å¢ƒç›£è¦–

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´7æœˆ13æ—¥  
**æ–‡å­—åŒ–ã‘å¯¾å¿œ**: å®Œäº†ï¼ˆPowerShellç”±æ¥ã®æ–‡å­—åŒ–ã‘ãƒ‘ã‚¿ãƒ¼ãƒ³ä¿®æ­£ï¼‰  
**æ©Ÿèƒ½çŠ¶æ…‹**: å…¨æ©Ÿèƒ½æ­£å¸¸å‹•ä½œç¢ºèªæ¸ˆã¿

## ã‚¨ãƒ©ãƒ¼è§£æãƒ»å¯¾å‡¦å±¥æ­´

### 2025å¹´7æœˆ13æ—¥: star_configã‚³ãƒãƒ³ãƒ‰ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ã‚¨ãƒ©ãƒ¼

#### ğŸš¨ ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: `star_config`ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå¾Œã€ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«é¸æŠæ™‚ã«ã€Œã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: 
```
ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ
```

#### ğŸ” æ ¹æœ¬åŸå› åˆ†æ

1. **Discord.js MessageComponentCollector ã®è¨­å®šã‚¨ãƒ©ãƒ¼**
   ```javascript
   // âŒ é–“é•ã£ãŸè¨­å®šï¼ˆè«–ç†ORæ¼”ç®—å­ä½¿ç”¨ï¼‰
   componentType: ComponentType.RoleSelect || ComponentType.ChannelSelect
   
   // âœ… æ­£ã—ã„è¨­å®šï¼ˆé…åˆ—å½¢å¼ï¼‰
   componentType: [ComponentType.RoleSelect, ComponentType.ChannelSelect]
   ```

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ä¸å‚™**
   - ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å‡¦ç†ã—ã¦ã—ã¾ã†å•é¡Œ
   - ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«é©åˆ‡ãªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æœªè¨­å®š

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸è¶³**
   - try-catchæ§‹æ–‡ã®æ§‹é€ çš„å•é¡Œ
   - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯ã®ä¸å‚™

#### ğŸ› ï¸ å®Ÿæ–½ã—ãŸå¯¾å‡¦æ³•

##### 1. ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ä¿®æ­£
```javascript
// ä¿®æ­£å‰
const collector = interaction.channel?.createMessageComponentCollector({
  componentType: ComponentType.RoleSelect || ComponentType.ChannelSelect,
  time: 60_000
});

// ä¿®æ­£å¾Œ
const collector = interaction.channel?.createMessageComponentCollector({
  componentType: [ComponentType.RoleSelect, ComponentType.ChannelSelect],
  filter: i => i.user.id === interaction.user.id,
  time: 60_000
});
```

**é‡è¦**: Discord.jsã§ã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã™ã‚‹å ´åˆã€é…åˆ—ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

##### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®è¿½åŠ 
```javascript
filter: i => i.user.id === interaction.user.id
```
- ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œè€…ä»¥å¤–ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’é™¤å¤–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š

##### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
```javascript
collector.on('collect', async selectInteraction => {
  try {
    // ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
    const customId = selectInteraction.customId;
    
    if (customId === 'admin_role_select') {
      // ãƒ­ãƒ¼ãƒ«å‡¦ç†
    } else if (customId === 'notify_channel_select') {
      // ãƒãƒ£ãƒ³ãƒãƒ«å‡¦ç†
    }
  } catch (error) {
    console.error('âŒ ã‚»ãƒ¬ã‚¯ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
    if (!selectInteraction.replied && !selectInteraction.deferred) {
      await selectInteraction.reply({
        content: 'âŒ å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',
        flags: 1 << 6,
        ephemeral: true
      });
    }
  }
});
```

##### 4. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®è§£æ±º
- é‡è¤‡ã—ãŸé–‰ã˜æ‹¬å¼§ã‚’å‰Šé™¤
- try-catchæ§‹æ–‡ã®æ­£ã—ã„æ§‹é€ ã«ä¿®æ­£

#### ğŸ“‹ ä¿®æ­£æ‰‹é †ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] **Discord.js APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ç¢ºèª**
  - MessageComponentCollectorã®æ­£ã—ã„ä½¿ç”¨æ³•
  - componentTypeãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä»•æ§˜ç¢ºèª

- [x] **ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ä¿®æ­£**
  - è«–ç†æ¼”ç®—å­ã‹ã‚‰é…åˆ—å½¢å¼ã«å¤‰æ›´
  - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã®è¿½åŠ 

- [x] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ **
  - try-catchæ§‹æ–‡ã§ã®å‡¦ç†ä¿è­·
  - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®é©åˆ‡ãªãƒã‚§ãƒƒã‚¯

- [x] **æ§‹æ–‡ãƒã‚§ãƒƒã‚¯**
  - `get_errors`ãƒ„ãƒ¼ãƒ«ã§ã®æ§‹æ–‡ç¢ºèª
  - Node.jsæ§‹æ–‡è§£æã§ã®æ¤œè¨¼

- [x] **Gitç®¡ç†ã¨ãƒ‡ãƒ—ãƒ­ã‚¤**
  - å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥
  - æœ¬ç•ªç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

#### ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆãƒ»ä»Šå¾Œã®å¯¾ç­–

1. **Discord.js v14ã®ä»•æ§˜ç†è§£**
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã¯é…åˆ—ã§æŒ‡å®š
   - è«–ç†æ¼”ç®—å­ã§ã®è¤‡æ•°æŒ‡å®šã¯ç„¡åŠ¹

2. **MessageComponentCollectorã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**
   - å¿…ãšãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’ä½¿ç”¨
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚’ç¢ºå®Ÿã«è¡Œã†
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã®å®Ÿè£…

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³**
   ```javascript
   // æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
   try {
     await interactionå‡¦ç†();
   } catch (error) {
     console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
     if (!interaction.replied && !interaction.deferred) {
       await interaction.reply({ content: 'ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', ephemeral: true });
     }
   }
   ```

4. **ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•**
   - ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§ã®çŠ¶æ…‹ç¢ºèª
   - Discord Developer Portalã§ã®ã‚¨ãƒ©ãƒ¼ç›£è¦–
   - æ®µéšçš„ãªã‚³ãƒ¼ãƒ‰æ¤œè¨¼

#### ğŸ”„ ä»Šå¾Œã®é¡ä¼¼ã‚¨ãƒ©ãƒ¼å¯¾å‡¦æ³•

1. **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆ**
   ```bash
   # 1. æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
   node -c commands/[ã‚³ãƒãƒ³ãƒ‰å].js
   
   # 2. Discord.js APIã®ç¢ºèª
   # - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã®ä»•æ§˜ç¢ºèª
   # - ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®äº’æ›æ€§
   
   # 3. ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®è¦‹ç›´ã—
   # - componentTypeã®é…åˆ—å½¢å¼ç¢ºèª
   # - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã®å®Ÿè£…ç¢ºèª
   ```

2. **äºˆé˜²çš„å¯¾ç­–**
   - æ–°æ©Ÿèƒ½å®Ÿè£…æ™‚ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¨™æº–åŒ–
   - å®šæœŸçš„ãªDiscord.jsæ›´æ–°ãƒã‚§ãƒƒã‚¯

#### ğŸ“Š å¯¾å‡¦çµæœ

- âœ… **å•é¡Œè§£æ±º**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±º
- âœ… **æ©Ÿèƒ½æ”¹å–„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¿½åŠ 
- âœ… **å®‰å®šæ€§å‘ä¸Š**: åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
- âœ… **ã‚³ãƒ¼ãƒ‰å“è³ª**: æ§‹æ–‡ã‚¨ãƒ©ãƒ¼0ä»¶é”æˆ

**æ¤œè¨¼æ¸ˆã¿ç’°å¢ƒ**: Discord.js v14.x, Node.js v20.x  
**ä¿®æ­£ã‚³ãƒŸãƒƒãƒˆ**: `3fb8454` - Fix star_config interaction failures

### è¿½åŠ ä¿®æ­£: 2025å¹´7æœˆ13æ—¥ - ãƒãƒ£ãƒ³ãƒãƒ«é¸æŠã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—

#### ğŸš¨ ç¶šç™ºã—ãŸã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«é¸æŠã¯ä¿®æ­£ã•ã‚ŒãŸãŒã€é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«é¸æŠæ™‚ã«ã¾ã ã€Œã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€ã‚¨ãƒ©ãƒ¼

#### ğŸ” æ ¹æœ¬åŸå› åˆ†æ
**MessageComponentCollectorå†…ã§ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ–¹æ³•ã®èª¤ã‚Š**
```javascript
// âŒ é–“é•ã£ãŸæ–¹æ³•ï¼ˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼å†…ã§replyä½¿ç”¨ï¼‰
return await selectInteraction.reply({
  content: 'ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
  flags: 1 << 6
});

// âœ… æ­£ã—ã„æ–¹æ³•ï¼ˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼å†…ã§ã¯updateä½¿ç”¨ï¼‰
return await selectInteraction.update({
  content: 'ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
  embeds: [getSettingsEmbed(...)],
  components: [row1, row2],
  flags: 1 << 6
});
```

#### ğŸ› ï¸ è¿½åŠ ä¿®æ­£å†…å®¹

##### 1. ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¿®æ­£
- `selectInteraction.reply()` â†’ `selectInteraction.update()`
- ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚‚UIè¦ç´ ï¼ˆembeds, componentsï¼‰ã‚’ç¶­æŒ

##### 2. æˆåŠŸæ™‚ã®ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
```javascript
await selectInteraction.update({
  embeds: [
    getSettingsEmbed(data.star_config.adminRoleIds, selectedChannelId),
    new EmbedBuilder()
      .setTitle('ğŸ“£ é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¨­å®šã—ã¾ã—ãŸ')
      .setDescription(`è¨­å®šã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«: <#${selectedChannelId}>`)
      .setColor(0x00cc99)
  ],
  components: [row1, row2],
  flags: 1 << 6
});
```

#### ğŸ’¡ é‡è¦ãªå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**MessageComponentCollectorã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«**:
- `collector.on('collect')` å†…ã§ã¯å¿…ãš `interaction.update()` ã‚’ä½¿ç”¨
- `interaction.reply()` ã¯ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼å¤–ã§ã®åˆå›ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã¿
- ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚UIçŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€embeds/componentsã‚’å«ã‚ã‚‹

#### ğŸ“Š æœ€çµ‚çš„ãªä¿®æ­£çµæœ
- âœ… **ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«é¸æŠ**: æ­£å¸¸å‹•ä½œï¼ˆå‰å›ä¿®æ­£ï¼‰
- âœ… **é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«é¸æŠ**: æ­£å¸¸å‹•ä½œï¼ˆä»Šå›ä¿®æ­£ï¼‰  
- âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: å®Ÿè£…æ¸ˆã¿
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åŒ…æ‹¬çš„å®Ÿè£…
- âœ… **UI/UXæ”¹å–„**: æˆåŠŸæ™‚ã®ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 

**è¿½åŠ ä¿®æ­£ã‚³ãƒŸãƒƒãƒˆ**: `f69de76` - Fix channel selection interaction failures

---

#### ğŸš¨ MessageComponentCollectorã®é‡è¦ãƒ«ãƒ¼ãƒ«

**åŸºæœ¬åŸå‰‡**: ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼å†…ã§ã¯`interaction.update()`ã®ã¿ä½¿ç”¨ã—ã€`interaction.reply()`ã¯ç¦æ­¢

```javascript
// âœ… æ­£ã—ã„ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ä½¿ç”¨æ³•
collector.on('collect', async (componentInteraction) => {
  try {
    // å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
    await componentInteraction.update({
      content: 'å‡¦ç†å®Œäº†',
      embeds: [updatedEmbed],
      components: [updatedComponents]
    });
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚updateã‚’ä½¿ç”¨ã—ã¦UIçŠ¶æ…‹ã‚’ç¶­æŒ
    await componentInteraction.update({
      content: 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
      embeds: [originalEmbed],
      components: [originalComponents]
    });
  }
});

// âŒ é–“é•ã£ãŸä½¿ç”¨æ³• - replyã¯ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—ã‚¨ãƒ©ãƒ¼ã®åŸå› 
collector.on('collect', async (componentInteraction) => {
  await componentInteraction.reply({ content: '...' }); // ã“ã‚Œã¯å¤±æ•—ã™ã‚‹
});
```
